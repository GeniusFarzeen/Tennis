<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZynPlay — Team Shooter (Demo)</title>
<style>
  :root{
    --bg:#071426; --panel:#0f2b42; --accent:#00d8ff; --danger:#ff6b6b;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;}
  body{background:linear-gradient(180deg,#041122,#071a2b);color:#dff6ff;display:flex;align-items:center;justify-content:center;padding:18px;}
  #wrap{width:100%;max-width:1100px;height:640px;background:linear-gradient(180deg,#082436,#05202e);border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6);position:relative;overflow:hidden;}
  canvas{display:block;width:100%;height:100%;}
  /* UI panels */
  .panel{
    position:absolute;top:12px;left:12px;background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
    font-size:14px;color:#cfeefc;
  }
  #rightPanel{right:12px;left:auto;}
  #loginOverlay{
    position:absolute;inset:0;background:rgba(5,10,18,0.82);display:flex;align-items:center;justify-content:center;z-index:40;
  }
  .card{background:linear-gradient(180deg,#072639,#06324a);padding:20px;border-radius:12px;width:360px;color:#dff6ff;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(0,0,0,0.3);}
  .card h2{margin:0 0 10px 0;color:var(--accent);}
  .input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:none;background:rgba(255,255,255,0.04);color:#dff6ff;}
  .btn{padding:10px 12px;border-radius:8px;border:none;background:var(--accent);color:#042935;font-weight:700;cursor:pointer;margin-top:8px;width:100%;}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dff6ff;}
  .small{font-size:13px;opacity:0.9;margin-top:6px;}
  .gun-list{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .gun-card{padding:8px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.02);}
  #teamPick{display:flex;gap:8px;margin-top:8px;}
  .team-btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  .team-red{background:#ff6b6b;color:#1b0d0d}
  .team-blue{background:#6bd7ff;color:#05212a}
  #msg{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:30;background:rgba(0,0,0,0.6);padding:18px;border-radius:10px;display:none;color:#fff;}
  footer{position:absolute;left:12px;bottom:12px;color:#89b8d6;font-size:13px;}
</style>
</head>
<body>
  <div id="wrap">
    <canvas id="c"></canvas>

    <div id="leftPanel" class="panel" style="top:12px;left:12px;">
      <div id="playerName">Guest</div>
      <div id="playerTeam" style="font-size:13px;opacity:0.9">Team: None</div>
      <div style="margin-top:10px;">
        <div style="font-size:12px;opacity:0.9">Gun:</div>
        <div id="currentGun" style="font-weight:700;color:var(--accent)">None</div>
      </div>
    </div>

    <div id="rightPanel" class="panel" style="top:12px;right:12px;">
      <div style="display:flex;gap:8px;align-items:center;">
        <div id="score">Kills: 0</div>
        <button id="logoutBtn" class="btn ghost" style="margin-left:8px;padding:6px 10px;">Logout</button>
      </div>
      <div style="margin-top:8px;font-size:13px;opacity:0.9">Controls: WASD / Arrow keys, Mouse aim, Click to shoot</div>
    </div>

    <div id="msg"></div>
    <div id="loginOverlay">
      <div class="card">
        <h2>ZynPlay — Team Shooter</h2>

        <div id="authTabs" style="display:flex;gap:8px;">
          <button id="tabLogin" class="btn ghost" style="width:50%;">Login</button>
          <button id="tabSignup" class="btn ghost" style="width:50%;">Sign Up</button>
        </div>

        <div id="loginBox" style="margin-top:12px;">
          <input id="loginUser" class="input" placeholder="Username" />
          <input id="loginPass" class="input" placeholder="Password" type="password" />
          <button id="doLogin" class="btn">Login</button>
          <div class="small">Or play as Guest (no save)</div>
          <button id="guestBtn" class="btn ghost">Play as Guest</button>
        </div>

        <div id="signupBox" style="display:none;margin-top:12px;">
          <input id="suUser" class="input" placeholder="Choose a username" />
          <input id="suPass" class="input" placeholder="Choose a password" type="password" />
          <div style="font-size:13px;opacity:0.9;margin-top:6px;">Pick initial gun:</div>
          <div class="gun-list" id="signupGuns"></div>
          <button id="doSignup" class="btn">Create Account</button>
          <div class="small">Usernames must be unique. Accounts stored locally in your browser (demo).</div>
        </div>

      </div>
    </div>

    <footer>Team Shooter Demo • Accounts local-only • Pre-created: <strong>Zynth</strong></footer>
  </div>

<script>
// --------- Simple localStorage account system ---------
// users stored as object { username: { password, gunId, team, inventory } }
const USERS_KEY = 'zynplay_users_v1';

// Pre-create users object if not present
let users = JSON.parse(localStorage.getItem(USERS_KEY) || '{}');

// Pre-create "Zynth" account with OP loadout if not exists
if(!users['Zynth']){
  users['Zynth'] = {
    password: 'GamerZynth',
    gunId: 'gun_sniper_op',
    team: 'Blue',
    inventory: ['gun_sniper_op','gun_shotgun','gun_smg','gun_pistol']
  };
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

// UI refs
const wrap = document.getElementById('wrap');
const overlay = document.getElementById('loginOverlay');
const tabLogin = document.getElementById('tabLogin');
const tabSignup = document.getElementById('tabSignup');
const loginBox = document.getElementById('loginBox');
const signupBox = document.getElementById('signupBox');
const loginUser = document.getElementById('loginUser');
const loginPass = document.getElementById('loginPass');
const doLogin = document.getElementById('doLogin');
const guestBtn = document.getElementById('guestBtn');
const suUser = document.getElementById('suUser');
const suPass = document.getElementById('suPass');
const doSignup = document.getElementById('doSignup');
const signupGuns = document.getElementById('signupGuns');
const playerNameDOM = document.getElementById('playerName');
const playerTeamDOM = document.getElementById('playerTeam');
const currentGunDOM = document.getElementById('currentGun');
const scoreDOM = document.getElementById('score');
const logoutBtn = document.getElementById('logoutBtn');
const msgBox = document.getElementById('msg');
const difficulty = 'normal'; // placeholder

// Gun definitions
const GUNS = {
  gun_pistol: { id:'gun_pistol', name:'Pistol', damage:18, rpm:300, bulletSpeed:9, burst:1, color:'#f5f5f5' },
  gun_smg:    { id:'gun_smg', name:'SMG', damage:10, rpm:700, bulletSpeed:11, burst:1, color:'#b3ffef' },
  gun_shotgun:{ id:'gun_shotgun', name:'Shotgun', damage:28, rpm:400, bulletSpeed:10, burst:5, spread:0.35, color:'#ffd9b3' },
  gun_sniper: { id:'gun_sniper', name:'Sniper', damage:70, rpm:60, bulletSpeed:18, burst:1, color:'#b3d1ff' },
  // OP sniper for Zynth
  gun_sniper_op:{ id:'gun_sniper_op', name:'Sniper-X', damage:140, rpm:90, bulletSpeed:26, burst:1, color:'#ffd36b' }
};

// fill signup guns UI
Object.values(GUNS).forEach(g=>{
  const el = document.createElement('div');
  el.className='gun-card';
  el.innerText = g.name;
  el.style.border = `1px solid ${g.color}`;
  el.onclick = ()=> {
    // mark selection
    [...signupGuns.children].forEach(c=>c.style.opacity=0.45);
    el.style.opacity = 1;
    el.dataset.selected = g.id;
    el.dataset.gun = g.id;
  };
  signupGuns.appendChild(el);
});

// make first gun selected visually
if(signupGuns.firstChild) signupGuns.firstChild.click();

// Auth logic
let currentUser = null; // { username, gunId, team, inventory }

function saveUsers(){ localStorage.setItem(USERS_KEY, JSON.stringify(users)); }

tabLogin.addEventListener('click', ()=>{ loginBox.style.display='block'; signupBox.style.display='none'; });
tabSignup.addEventListener('click', ()=>{ loginBox.style.display='none'; signupBox.style.display='block'; });

doSignup.addEventListener('click', ()=>{
  const u = suUser.value.trim();
  const p = suPass.value;
  const picked = [...signupGuns.children].find(c=>c.dataset.gun)?.dataset.gun || 'gun_pistol';
  if(!u || !p){ alert('Choose username & password'); return; }
  if(users[u]){ alert('Username already taken! Pick another'); return; }
  users[u] = { password: p, gunId: picked, team:'Red', inventory: [picked,'gun_pistol'] };
  saveUsers();
  alert('Account created! Now login.');
  // switch to login tab
  tabLogin.click();
  loginUser.value = u;
  loginPass.value = p;
});

doLogin.addEventListener('click', ()=>{
  const u = loginUser.value.trim();
  const p = loginPass.value;
  if(!u || !p){ alert('Enter credentials'); return; }
  if(!users[u] || users[u].password !== p){ alert('Incorrect username or password'); return; }
  // load user
  currentUser = { username: u, ...users[u] };
  startGameForCurrentUser();
});

guestBtn.addEventListener('click', ()=>{
  currentUser = { username: 'Guest', gunId: 'gun_pistol', team:'Red', inventory:['gun_pistol'] };
  startGameForCurrentUser();
});

logoutBtn.addEventListener('click', ()=>{
  currentUser = null;
  overlay.style.display = 'flex';
});

// apply the current user to UI and hide overlay
function startGameForCurrentUser(){
  overlay.style.display = 'none';
  playerNameDOM.innerText = currentUser.username;
  playerTeamDOM.innerText = 'Team: ' + (currentUser.team || 'Red');
  currentGunDOM.innerText = GUNS[currentUser.gunId]?.name || 'Pistol';
  // launch the canvas game
  initGame();
}

// ------------------ Game Core (single-file simple demo) ------------------
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha:false });
function resize(){ canvas.width = wrap.clientWidth; canvas.height = wrap.clientHeight; }
window.addEventListener('resize', resize);
resize();

// player state
let player = { x:150, y:320, speed: 3.2, angle:0, gun: null, lastShot:0 };
let bullets = [];
let npcs = [];
let score = 0;
let keys = {};

// basic NPC spawn
function spawnNPC(){
  const side = Math.random() < 0.5 ? 'right' : 'top';
  let npc = { x: canvas.width - 60, y: Math.random()*(canvas.height-140) + 80, vx:-0.6 - Math.random()*0.6, hp:80 + Math.random()*40, r:18 };
  npcs.push(npc);
}

// initialize player gun from user
function equipUserGun(){
  player.gun = GUNS[currentUser.gunId] || GUNS['gun_pistol'];
  currentGunDOM.innerText = player.gun.name;
}

// input
window.addEventListener('keydown', e=> keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e=> keys[e.key.toLowerCase()] = false);

// aim and shoot
let mouse = { x:0, y:0, down:false };
canvas.addEventListener('mousemove', e=> {
  const r = canvas.getBoundingClientRect();
  mouse.x = e.clientX - r.left; mouse.y = e.clientY - r.top;
});
canvas.addEventListener('mousedown', e=> mouse.down = true);
canvas.addEventListener('mouseup', e=> mouse.down = false);
canvas.addEventListener('touchstart', e=> { mouse.down = true; mouse.x = e.touches[0].clientX - canvas.getBoundingClientRect().left; mouse.y = e.touches[0].clientY - canvas.getBoundingClientRect().top; }, {passive:true});
canvas.addEventListener('touchend', e=> mouse.down = false);

// shooting logic
function tryShoot(now){
  const g = player.gun;
  if(!g) return;
  const msPerShot = 60000 / g.rpm;
  if(now - player.lastShot < msPerShot) return;
  player.lastShot = now;
  // spawn bullets (burst support)
  const bx = player.x + 20;
  const by = player.y;
  const angle = Math.atan2(mouse.y - by, mouse.x - bx);
  if(g.burst && g.burst > 1){
    // shotgun: spawn multiple pellets
    const count = g.burst;
    for(let i=0;i<count;i++){
      const spread = (Math.random()-0.5) * (g.spread || 0.3);
      bullets.push({ x:bx, y:by, vx: Math.cos(angle+spread)*g.bulletSpeed, vy: Math.sin(angle+spread)*g.bulletSpeed, dmg: g.damage, life: 2200 });
    }
  } else {
    bullets.push({ x:bx, y:by, vx: Math.cos(angle)*g.bulletSpeed, vy: Math.sin(angle)*g.bulletSpeed, dmg: g.damage, life: 4000 });
  }
}

// simple collision
function rectCircleHit(cx, cy, r, bx, by){
  return Math.hypot(bx - cx, by - cy) <= r;
}

// main loop
let last = performance.now();
let spawnTimer = 0;
let npcSpawnRate = 1800;
function loop(now){
  const dt = Math.min(40, now - last);
  last = now;

  // resize-safe
  if(canvas.width !== wrap.clientWidth || canvas.height !== wrap.clientHeight) resize();

  // input movement
  let mvx = 0, mvy = 0;
  if(keys['w'] || keys['arrowup']) mvy -= 1;
  if(keys['s'] || keys['arrowdown']) mvy += 1;
  if(keys['a'] || keys['arrowleft']) mvx -= 1;
  if(keys['d'] || keys['arrowright']) mvx += 1;
  const mag = Math.hypot(mvx, mvy) || 1;
  player.x += (mvx/mag) * player.speed * (dt/16);
  player.y += (mvy/mag) * player.speed * (dt/16);
  // clamp to play area
  player.x = Math.max(80, Math.min(canvas.width-60, player.x));
  player.y = Math.max(40, Math.min(canvas.height-40, player.y));

  // shooting
  if(mouse.down) tryShoot(now);

  // update bullets
  for(let i = bullets.length-1;i>=0;i--){
    const b = bullets[i];
    b.x += b.vx * (dt/16);
    b.y += b.vy * (dt/16);
    b.life -= dt;
    // remove offscreen or expired
    if(b.life <= 0 || b.x < -20 || b.x > canvas.width+20 || b.y < -20 || b.y > canvas.height+20){
      bullets.splice(i,1);
      continue;
    }
    // check hit NPCs
    for(let j=npcs.length-1;j>=0;j--){
      const n = npcs[j];
      if(rectCircleHit(n.x, n.y, n.r, b.x, b.y)){
        n.hp -= b.dmg;
        bullets.splice(i,1);
        // small reward
        if(n.hp <= 0){
          // kill
          stateScoreAdd(1);
          npcs.splice(j,1);
        }
        break;
      }
    }
  }

  // update NPCs
  for(let i=npcs.length-1;i>=0;i--){
    const n = npcs[i];
    n.x += n.vx * (dt/16);
    // small simple AI: move toward player vertically sometimes
    if(Math.random() < 0.02) n.y += (player.y - n.y) > 0 ? 6 : -6;
    // if NPC reaches base area (left side) and same team difference -> they damage you (end round)
    if(n.x < 90){
      // npc reached base => game over condition
      showMsgOverlay('You Lost — NPC reached base', false);
      return; // stop loop till restart
    }
  }

  // spawn NPCs occasionally
  spawnTimer += dt;
  if(spawnTimer > npcSpawnRate){
    spawnTimer = 0;
    spawnNPC(); // spawn function defined earlier
    // reduce spawn rate when level increases? for demo keep constant
  }

  // draw
  drawScene();

  anim = requestAnimationFrame(loop);
}

// draw helper
function drawScene(){
  // background
  const g = ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,'#051322'); g.addColorStop(1,'#062233');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

  // base area
  ctx.fillStyle = '#0f3a57'; ctx.fillRect(0,canvas.height-120,140,120);
  ctx.fillStyle = 'rgba(255,255,255,0.03)'; ctx.fillRect(0,0,120,canvas.height);

  // player
  ctx.save();
  ctx.translate(player.x, player.y);
  // draw player body
  ctx.fillStyle = currentUser && currentUser.team === 'Blue' ? '#6bd7ff' : '#ff6b6b';
  ctx.beginPath(); ctx.arc(0,0,14,0,Math.PI*2); ctx.fill();
  // draw gun direction
  ctx.fillStyle = '#cfeefc';
  ctx.beginPath(); ctx.rect(12,-4,18,8); ctx.fill();
  ctx.restore();

  // bullets
  for(const b of bullets){
    ctx.fillStyle = '#ffd'; ctx.fillRect(b.x-3,b.y-3,6,6);
  }

  // npcs
  for(const n of npcs){
    ctx.fillStyle = '#ffd9b3';
    ctx.beginPath(); ctx.arc(n.x, n.y, n.r,0,Math.PI*2); ctx.fill();
    // hp bar
    ctx.fillStyle = '#000';
    ctx.fillRect(n.x - 24, n.y - n.r - 12, 48, 6);
    ctx.fillStyle = n.hp > 60 ? '#6de06d' : (n.hp > 30 ? '#ffd36b' : '#ff6b6b');
    const w = Math.max(0, Math.round(48 * (n.hp / 120)));
    ctx.fillRect(n.x - 24, n.y - n.r - 12, w, 6);
  }

  // HUD text
  ctx.fillStyle = '#cfeefc'; ctx.font = '14px Inter';
  ctx.fillText('User: ' + (currentUser?.username || 'Guest'), 14, 20);
  ctx.fillText('Kills: ' + score, 14, 40);
}

// score helper
function stateScoreAdd(val){
  score += val;
  scoreDOM.innerText = 'Kills: ' + score;
}

// show overlay message and stop game
function showMsgOverlay(text, ok){
  msgBox.style.display = 'block';
  msgBox.innerText = text;
  // stop loop
  cancelAnimationFrame(anim);
  // small restart button inside message
  setTimeout(()=> {
    msgBox.style.display = 'none';
    // restart quick by resetting world
    resetWorld();
  }, 1800);
}

// reset world
function resetWorld(){
  bullets = [];
  npcs = [];
  player.x = 150; player.y = canvas.height/2;
  score = 0; scoreDOM.innerText = 'Kills: 0';
  spawnTimer = 0;
  last = performance.now();
  anim = requestAnimationFrame(loop);
}

// initialize game (called after login)
let anim = null;
function initGame(){
  equipUserGun();
  // spawn some npcs initially
  for(let i=0;i<3;i++) spawnNPC();
  last = performance.now();
  anim = requestAnimationFrame(loop);
}

// On first load, set login overlay visible — already shown
// But if user was auto-logged (we didn't implement auto), we call startGameForCurrentUser.

// helper: prevent using duplicate username on signup is handled earlier.
// logout handled earlier by showing overlay again.

</script>
</body>
</html>
